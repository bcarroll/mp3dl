{%extends 'base.html'%}
{%set title='MP3 Downloader'%}
{%block body%}
<div class="container-fluid">
{% if results %}
<table class="table table-dark table-striped mt-5">
    <thead>
        <tr>
            <th scope="col"></th>
            <th scope="col">Title</th>
            <th scope="col">Date Published</th>
            <th scope="col"></th>
            <th scope="col"></th>
        </tr>
    </thead>
    <tbody>
    {% for result in results %}
    <tr>
        <td scope="row"><img src="{{results[result]['img']['url']}}"></td>
        <td>{{results[result]['title']}}</td>
        <td>{{results[result]['published']}}</td>
        <td>
            <button id="dl_{{result}}" class="btn btn-primary">Download</button><br/>
            <button id="btn_{{result}}" class="btn btn-secondary" value="{{result}}">Play</button>
        </td>
    </tr>
    {%endfor%}
    </tbody>
</table>
{%endif%}
</div>
<iframe id="player" width="0" height="0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
{%endblock%}
{%block script%}
<script>
    $('button[id^="btn_"]').click(function(e){
        var button = $('#' + this.id);
        var url = '';
        if (button.text() == 'Play'){
            var id = button.val();
            url = 'https://www.youtube.com/embed/' + id + '?autoplay=1';
            button.text("Stop");
        } else {
            button.text("Play");
        }
        $('#player').attr('src', url);
    })
</script>
{%endblock%}
